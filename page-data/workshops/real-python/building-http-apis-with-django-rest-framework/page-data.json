{"componentChunkName":"component---src-templates-note-template-tsx","path":"/workshops/real-python/building-http-apis-with-django-rest-framework/","result":{"data":{"markdownRemark":{"html":"<p><a href=\"https://realpython.com/courses/django-rest-framework/\">https://realpython.com/courses/django-rest-framework/</a></p>\n<h2>REST</h2>\n<ul>\n<li>Client-server architecture</li>\n<li>Stateless</li>\n<li>Cacheable</li>\n<li>Layered system</li>\n<li>Code on demand</li>\n<li>Uniform interface\n<ul>\n<li>Resources are identified as requests</li>\n<li>Resource manipulation through representations</li>\n<li>Self-descriptive messages</li>\n<li>Hypermedia as the engine of application state (HATEOAS)</li>\n</ul>\n</li>\n</ul>\n<h2>Django REST Framework</h2>\n<ul>\n<li>Toolkit for developing RESTful APIs in Django</li>\n<li>Integrastes with Django models, views and URL patterns</li>\n<li>Provides mechanisms for both function and class based views</li>\n<li>Serialization for both ORM and non-ORM data sources</li>\n<li>Built-in web interface</li>\n<li><a href=\"https://www.django-rest-framework.org/\">https://www.django-rest-framework.org/</a></li>\n</ul>\n<h3>DRF Serialization and Views</h3>\n<ul>\n<li>Serializers\n<ul>\n<li>Change objects into text aqnd text back into objects</li>\n<li>With or without Django ORM</li>\n</ul>\n</li>\n<li>Views\n<ul>\n<li>Utilities to write Django views that serialize and deserialize data</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"language-python\"># people/models.py\nfrom django.db import models\n\n\nclass Person(models.Model):\n    first = models.CharField(max_length=50)\n    last = models.CharField(max_length=50)\n    title = models.CharField(max_length=5)\n    \n    class Meta:\n        verbose_name_plural = \"People\"\n\n \n\n# people/serializers.py\nfrom rest_framework import serializers\nfrom .models import Person\n\n\nclass PersonSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = Person\n        fields = ['id', 'first', 'last', 'title']\n\n\n# people/views.py\nfrom rest_framework.decorators import api_view\nfrom rest_framework.response import Response\n\nfrom .models import Person\nfrom .serializers import PersonSerializer\n\n\n@api_view(['GET'])\ndef list_people(request):\n    people = Person.objects.all()\n    serializer = PersonSerializer(people, many=True)\n    content = {\n        \"people\": serializer.data\n    }\n\n    return Response(content)\n</code></pre>\n<pre><code class=\"language-bash\">curl -s http://127.0.0.1:8000/people/list_people/ | python -m json.tool  \n</code></pre>\n<h3>DRF ViewSets</h3>\n<ul>\n<li>ViewSets\n<ul>\n<li>Class based utilities for encaspsulating common REST/HTTP methods</li>\n<li>Automatically get List, Retrieve, Create, Update, Update Partial, and Delete actions</li>\n<li>Router define all the URL mappings</li>\n</ul>\n</li>\n<li>Routers\n<ul>\n<li>Map between ViewSets and Django URL routes</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"language-python\"># artifacts/views.py\nfrom rest_framework import viewsets\n\nfrom .models import Artifact\nfrom .serializers import ArtifactSerializer\n\n\nclass ArtifactViewSet(viewsets.ModelViewSet):\n    serializer_class = ArtifactSerializer\n\n    def get_queryset(self):\n        return Artifact.objects.all()\n\n\n# artifacts/urls.py\nfrom django.urls import path, include\nfrom rest_framework.routers import DefaultRouter\n\nfrom . import views\n\nrouter = DefaultRouter()\nrouter.register(r'artifacts', views.ArtifactViewSet, 'artifact')\n\nurlpatterns = [\n    path('', include(router.urls)),\n]\n\n</code></pre>\n<pre><code class=\"language-bash\">curl -s http://127.0.0.1:8000/artifacts/ | python -m json.tool    # prints router urls\ncurl -s http://127.0.0.1:8000/artifacts/artifacts/ | python -m json.tool \ncurl -s http://127.0.0.1:8000/artifacts/artifacts/2/ | python -m json.tool  \ncurl -s -X POST -d \"name=Ark of the Covenant\" -d \"shiny=True\"  http://127.0.0.1:8000/artifacts/artifacts/ | python -m json.tool \ncurl -s -X PUT -d \"name=Golden Idol\" -d \"shiny=True\"  http://127.0.0.1:8000/artifacts/artifacts/1/ | python -m json.tool \ncurl -s -X PATCH -d \"shiny=False\"  http://127.0.0.1:8000/artifacts/artifacts/1/ | python -m json.tool  \ncurl -s -X DELETE http://127.0.0.1:8000/artifacts/artifacts/1/ \n</code></pre>\n<h3>Web Interface and Renderers</h3>\n<ul>\n<li>Web Interface\n<ul>\n<li>Out of the box, DRF comes with a web interface</li>\n</ul>\n</li>\n<li>Renderers\n<ul>\n<li>Type of response is based on:\n<ul>\n<li>Renderers installed</li>\n<li>HTTP Accept header</li>\n</ul>\n</li>\n<li>Change the renderer in settings.py</li>\n<li>Alternatively, you can set the renderer in the viewset</li>\n<li>Third party packages for more formats</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/notes/static/c6f0483b9562bd9bead91f0e9a68b647/83bab/django-rest-framework-web-interface.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.65030674846626%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABCElEQVR42q2PTW6DMBCFuf8tuqgiZZEYDCQRkAXtAXqFSjSVmqoNiX+wwX4daBYg0qqLjvRprJl5b8ZBmWd4LPZ4yPfI4g22LMYuSob3T+TULzdblFmBIk2RJRx53+MpgoRzxFE0wMMQbLUacsQYwvV6Rl9fLJa4u1+CsQgJJ23IwFmIlLwCjKJzDlprOMoe8/DX4qG2eKoEat1+10czgaepruvQZykVnqsDjh9nCKEgVUM1PUEIDdM0cNbCka5fPmZyYdu2OL2+Q3xeoEmozxL6ouhqM0HRIiEbOsTNfjExdHS7fDlCVm9QtYQi016slLnJHww9DA0aMrLGwtruSnsT5/zvhv8RXwrIVLpqCw3sAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Web Interface\"\n        title=\"\"\n        src=\"/notes/static/c6f0483b9562bd9bead91f0e9a68b647/a6d36/django-rest-framework-web-interface.png\"\n        srcset=\"/notes/static/c6f0483b9562bd9bead91f0e9a68b647/222b7/django-rest-framework-web-interface.png 163w,\n/notes/static/c6f0483b9562bd9bead91f0e9a68b647/ff46a/django-rest-framework-web-interface.png 325w,\n/notes/static/c6f0483b9562bd9bead91f0e9a68b647/a6d36/django-rest-framework-web-interface.png 650w,\n/notes/static/c6f0483b9562bd9bead91f0e9a68b647/e548f/django-rest-framework-web-interface.png 975w,\n/notes/static/c6f0483b9562bd9bead91f0e9a68b647/3c492/django-rest-framework-web-interface.png 1300w,\n/notes/static/c6f0483b9562bd9bead91f0e9a68b647/83bab/django-rest-framework-web-interface.png 4118w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>Permissions</h3>\n<ul>\n<li>DRF <code>IsAdminUser</code>is more like <code>is_staff</code></li>\n<li>object level can be checked</li>\n<li>By default inside of BasePermission, permission is granted</li>\n<li>Listing is different than updates/items</li>\n<li>A few things can acccidentally expose things</li>\n</ul>\n<pre><code class=\"language-python\">from django.contrib.auth.decorators import login_required\nfrom django.shortcuts import render\n\nfrom rest_framework import viewsets\nfrom rest_framework.permissions import BasePermission\n\nfrom .models import Book\nfrom .serializers import BookSerializer\n\n\nclass IsSuperUser(BasePermission):\n    def has_permission(self, request, view):\n        return request.user.is_superuser\n    \n    def has_object_permission(self, request, view, obj):\n        return request.user.is_superuser\n    \n\nclass IsIndy(BasePermission):\n    def has_object_permission(self, request, view, obj):\n        if not obj.restricted:\n            return True\n        \n        return request.user.username == 'indy'\n\n\nclass BookViewSet(viewsets.ModelViewSet):\n    serializer_class = BookSerializer\n    permission_classes = [IsIndy | IsSuperUser]\n\n    def get_queryset(self):\n        if self.request.user.is_staff:\n            return Book.objects.all()\n        \n        return Book.objects.filter(restricted=False)\n    \n\n@login_required\ndef library(request):\n    return render(request, 'library.html')\n</code></pre>\n<h3>Serializers without ORM</h3>\n<ul>\n<li>Inherit from <code>serializers.Serializer</code> class and combine fields to construct arbitrary objects</li>\n<li>similar to how you declare ORM objects</li>\n<li><a href=\"https://www.django-rest-framework.org/api-guide/fields/\">https://www.django-rest-framework.org/api-guide/fields/</a></li>\n</ul>\n<pre><code class=\"language-python\"># vehicles/models/tools.py\nclass Tool:\n    def __init__(self, name, make):\n        self.name = name\n        self.make = make\n        \n         \n# vehicles/serializers/tools.py\nfrom rest_framework import serializers\n\n\nclass ToolSerializer(serializers.Serializer):\n    name = serializers.CharField(max_length=50)\n    make = serializers.CharField(max_length=50)\n\n# vehicles/views/tools.py\nfrom rest_framework.decorators import api_view\nfrom rest_framework.response import Response\n\nfrom vehicles.models import Tool\nfrom vehicles.serializers.tools import ToolSerializer\n\n\n@api_view(['GET'])\ndef list_tools(request):\n    tools = [\n        Tool(\"hammer\", \"Mastercraft\"),\n        Tool(\"wrench\", \"Husky\")\n    ]\n\n    serializer = ToolSerializer(tools, many=True)\n    content = {\n        \"tools\": serializer.data\n    }\n\n    return Response(content)\n\n</code></pre>\n<h3>Nested Django ORM objects</h3>\n<ul>\n<li>DRF provides methods for serializing related ORM objects</li>\n<li>Reference foreign keys by id</li>\n<li>Nest serialized relationships</li>\n</ul>\n<pre><code class=\"language-python\"># vehicles/models/vehicles.py\nfrom django.db import models\n\n\nclass Vehicle(models.Model):\n    name = models.CharField(max_length=100)\n\n\nclass Part(models.Model):\n    name = models.CharField(max_length=100)\n    make = models.CharField(max_length=100)\n    vehicle = models.ForeignKey(Vehicle, on_delete=models.CASCADE)\n\n\n# vehicles/serializers/vehicles.py\nfrom rest_framework import serializers\nfrom vehicles.models import Vehicle, Part\n\n\nclass SerialNumberField(serializers.Field):\n    def to_representation(self, value):\n        code = value.make[:3].upper()\n        return f\"{code}-{value.id}\"\n    \n\nclass PartSerializer(serializers.ModelSerializer):\n    serial_no = SerialNumberField(source=\"*\")\n\n    class Meta:\n        model = Part\n        fields = [\"url\", \"name\", \"vehicle\", \"serial_no\"]\n\n\nclass VehicleSerializer(serializers.ModelSerializer):\n    part_set = PartSerializer(many=True, read_only=True)\n\n    class Meta:\n        model = Vehicle\n        fields = [\"url\", \"name\", \"part_set\"]\n\n# vehicles/views/vehicles.py\nfrom rest_framework import viewsets\nfrom rest_framework.response import Response\n\nfrom vehicles.models import Vehicle, Part\nfrom vehicles.serializers.vehicles import VehicleSerializer, PartSerializer\n\n\nclass PartViewSet(viewsets.ModelViewSet):\n    queryset = Part.objects.all()\n    serializer_class = PartSerializer\n\n\nclass VehicleViewSet(viewsets.ModelViewSet):\n    serializer_class = VehicleSerializer\n\n    def get_queryset(self):\n        return Vehicle.objects.all()\n</code></pre>\n<h3>ViewSet Actions</h3>\n<ul>\n<li>compounded serialization\n<ul>\n<li>A common pattern is to declare an API that includes multiple objects</li>\n<li>Everything you might need in a single-page application</li>\n<li>Delcare aq view and nest multiple serializers</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"language-python\"># api/urls.py\nfrom django.urls import path, include\nfrom rest_framework.routers import DefaultRouter\n\nfrom . import views\n\nrouter = DefaultRouter()\nrouter.register(r\"doctors\", views.DoctorsViewSet, \"doctors\")\nrouter.register(r\"mass_delete\", views.MassDeleteArtifactsViewSet, \"mass_delete\")\n\nurlpatterns = [\n    path(\"v1/\", include(router.urls)),\n    path(\"v1/listing/\", views.listing),\n]\n\n# api/views.py\nfrom rest_framework import viewsets, mixins\nfrom rest_framework.decorators import action, api_view\nfrom rest_framework.response import Response\n\nfrom artifacts.models import Artifact\nfrom people.models import Person\nfrom vehicles.models import Vehicle\nfrom people.serializers import PersonSerializer\nfrom vehicles.serializers.vehicles import VehicleSerializer\n\n\nclass DoctorsViewSet(mixins.ListModelMixin, viewsets.GenericViewSet):\n    def list(self, request):\n        doctors = Person.objects.filter(title=\"Dr.\")\n        results = {\n            \"doctors\": PersonSerializer(doctors, many=True).data,\n        }\n\n        return Response(results)\n    \n\nclass MassDeleteArtifactsViewSet(mixins.DestroyModelMixin, \n                                 viewsets.GenericViewSet):\n    @action(detail=False, methods=[\"delete\"])\n    def mass_delete(self, request, pk=None):\n        for artifact_id in request.POST['ids'].split(\",\"):\n            Artifact.objects.get(id=artifact_id).delete()\n\n        return Response()\n\n\n@api_view([\"GET\"])\ndef listing(request):\n    doctors = Person.objects.filter(title=\"Dr.\")\n    Vehicles = Vehicle.objects.all()\n\n    context = {\n        \"request\": request,\n    }\n    vehicle_serializer = VehicleSerializer(Vehicles, \n                                           many=True, \n                                           context=context)\n    results = {\n        \"doctors\": PersonSerializer(doctors, many=True).data,\n        \"vehicles\": vehicle_serializer.data,\n    }\n\n    return Response(results)\n\n</code></pre>","frontmatter":{"date":"June 06, 2025","title":"Building HTTP APIs With Django REST Framework","tags":["course","real-python","django"]}}},"pageContext":{"slug":"/workshops/real-python/building-http-apis-with-django-rest-framework/"}},"staticQueryHashes":["1796642556","2356112386","3489759178"],"slicesMap":{}}