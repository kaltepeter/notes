{
    "componentChunkName": "component---src-templates-note-template-tsx",
    "path": "/workshops/railsbook-tutorial/",
    "result": {"data":{"markdownRemark":{"html":"<ul>\n<li><a href=\"https://www.railstutorial.org/book\">Rails Book Tutorial</a></li>\n</ul>\n<h2>Tools</h2>\n<ul>\n<li>Cloud 9. Visit <a href=\"https://console.aws.amazon.com/\">https://console.aws.amazon.com/</a> and search for cloud 9 for online environment</li>\n<li>Heroku. Login:</li>\n</ul>\n<h2>Ruby on Rails</h2>\n<p><code>echo \"gem: --no-document\" >> ~/.gemrc</code> save time by skipping downloading docs\n<code>gem install rails -v 7.0.4</code> install rails, particular version\n<code>gem install bundler -v 2.3.14</code> install bundler, particular version\n<code>source &#x3C;(curl -sL https://cdn.learnenough.com/resize)</code> resize cloud9 vm\n<code>rails _7.0.4_ new hello_app --skip-bundle</code> create app but allow for gemfile modifications. You can edit the gemfile versions before continuing.\n<code>bundle _2.3.14_ install</code> run install\n<code>rails server</code> or <code>rails s</code> start the server.</p>\n<p>For cloud9 make sure to edit the development environment config and add:</p>\n<pre><code class=\"language-ruby\">  config.hosts.clear\n  config.web_console.whitelisted_ips = [&#x3C;your_ip>]\n</code></pre>\n<p><code>git config --global init.defaultBranch main</code> set default branch name\n<code>git config --global credential.helper \"cache --timeout=86400\"</code> set login cache time for easy use in cloud9\n<code>git branch -M main</code> set the main branch</p>\n<p>building without production gems</p>\n<pre><code class=\"language-bash\">bundle _2.3.14_ config set --local without 'production'\nbundle _2.3.14_ install\nbundle _2.3.14_ lock --add-platform x86_64-linux\nsource &#x3C;(curl -sL https://cdn.learnenough.com/heroku_install) # install heroku\n</code></pre>\n<p><code>heroku login -i</code> login on the cloud app\n<code>git push heroku main</code> push branch up to heroku\n<code>heroku logs</code> show logs\n<code>herokue app:info</code> get app info</p>\n<p><code>rails generate scaffold User name:string email:string</code> scaffold users\n<code>rails db:migrate</code> apply db changes\n<code>heroku run rails db:migrate</code> migrate db in heroku\n<code>heroku logs --tail</code> watch logs\n<code>rails destroy controller StaticPages home help</code> remove a controller\n<code>rails destroy model User</code> remove a user\n<code>rails db:rollback</code> rollback migration</p>\n<h2>ERB</h2>\n<p><code>&#x3C;% ... %></code> executes code\n<code>&#x3C;%= ... %></code> executes and inserts\n<code>&#x3C;%= yield %></code> inserts page contents</p>\n<p>test_helper.rb</p>\n<pre><code class=\"language-ruby\">require \"minitest/reporters\"\nMinitest::Reporters.use!\n</code></pre>\n<p><code>bundle _2.3.14_ exec guard init</code> add guard to watch tests\n<code>bundle _2.3.14_ exec guard</code> run guard</p>\n<p>For Cloud9, edit <code>~/.irbrc</code>:</p>\n<pre><code>IRB.conf[:PROMPT_MODE] = :SIMPLE\nIRB.conf[:AUTO_INPUT_MODE] = false\n</code></pre>\n<p><code>rails c</code> open IRB</p>\n<p><code>attr_accessor :name, :email</code> adds getter and setter to the class\n<code>@name</code> is an instance var</p>\n<p><a href=\"https://en.wikipedia.org/wiki/Active_record_pattern\">https://en.wikipedia.org/wiki/Active_record_pattern</a>\n<a href=\"https://sqlitebrowser.org/\">https://sqlitebrowser.org/</a></p>\n<p><code>brew install --cask db-browser-for-sqlite</code> install sqlite browser</p>\n<p><code>rails console --sandbox</code> load console in a sandbox, any modficaitons are rolled back on exit</p>\n<p>DB migrations</p>\n<p>The rails way is to generate a migraion: <code>rails generate migration add_index_to_users_email</code></p>\n<p><code>self.email = email.downcase</code> is ok, <code>email = email.downcase</code> is not. Assignment requires self, the value does not</p>\n<p><code>heroku run rails db:migrate</code> production db migrate\n<code>heroku run rails console --sandbox</code> run the rails console on production heroku</p>\n<p><code>&#x3C;%= debug(params) if Rails.env.development? %></code> debug params\n<code>rails server --environment production</code> run production\n<code>rails db:migrate RAILS_ENV=production</code> migrate production</p>\n<p><a href=\"https://stackoverflow.com/questions/941594/understanding-the-rails-authenticity-token\">https://stackoverflow.com/questions/941594/understanding-the-rails-authenticity-token</a></p>\n<p><code>assert_no_difference</code> use for db testing, more idiomatic</p>\n<p>concerns are a way of mixing in functionality.</p>\n<p><a href=\"https://www.akshaykhot.com/how-rails-concerns-work-and-how-to-use-them/\">https://www.akshaykhot.com/how-rails-concerns-work-and-how-to-use-them/</a></p>\n<p><a href=\"https://guides.rubyonrails.org/security.html#session-fixation\">session fixation</a> use <code>reset_session</code> to avoid</p>\n<p><code>@current_user = @current_user || User.find_by(id: session[:user_id])</code> and <code>@current_user ||= User.find_by(id: session[:user_id])</code> are the same, the latter is more idiomatic</p>\n<p><code>rails importmap:install turbo:install stimulus:install</code> usually run automatically but we skipped with <code>--skip-bundle</code></p>\n<p><code>user&#x26;.authenticate</code> safe navigation operator</p>\n<p><code>unless @user == current_user</code> is the same as <code>unless current_user?(@user)</code>, the latter is more idiomatic and expressive</p>\n<pre><code class=\"language-bash\">rails db:migrate:reset\nrails db:seed\n</code></pre>\n<pre><code class=\"language-ruby\">user.microposts.build(arg) # more idiomatic, through relationship\nuser.microposts.find_by(id: 1)\n</code></pre>\n<p><code>build</code> is an alias for <code>new</code></p>\n<p><code>default_scope -> { order(created_at: :desc) }</code> sort desending on create date\n<code>-></code> is stabby lambda syntax, takes a block and returns a proc</p>\n<p><a href=\"https://github.com/faker-ruby/faker\">https://github.com/faker-ruby/faker</a></p>\n<p>private methods can be called from derived classes</p>\n<p><a href=\"https://guides.rubyonrails.org/active_record_querying.html\">https://guides.rubyonrails.org/active_record_querying.html</a></p>\n<p>cloud 9 memory/cpu issues</p>\n<p><a href=\"https://docs.aws.amazon.com/cloud9/latest/user-guide/troubleshooting.html#troubleshooting-ide-low-memory\">https://docs.aws.amazon.com/cloud9/latest/user-guide/troubleshooting.html#troubleshooting-ide-low-memory</a></p>\n<pre><code class=\"language-bash\">sudo swapon --show\nsudo swapoff -a # if running\nsudo fallocate --length 512MB /var/swapfile &#x26;&#x26; sudo chmod 600 /var/swapfile &#x26;&#x26; sudo mkswap /var/swapfile &#x26;&#x26; echo '/var/swapfile swap swap defaults 0 0' | sudo tee -a /etc/fstab > /dev/null\nsudo swapon /var/swapfile\n</code></pre>\n<p>image upload</p>\n<pre><code class=\"language-bash\">rails active_storage:install\nrails db:migrate\n</code></pre>\n<pre><code class=\"language-bash\">sudo apt-get -y install imagemagick\n</code></pre>\n<pre><code class=\"language-ruby\">amazon:\n  service: S3\n  access_key_id:     &#x3C;%= ENV['AWS_ACCESS_KEY_ID'] %>\n  secret_access_key: &#x3C;%= ENV['AWS_SECRET_ACCESS_KEY'] %>\n  region:            &#x3C;%= ENV['AWS_REGION'] %>\n  bucket:            &#x3C;%= ENV['AWS_BUCKET'] %>\n</code></pre>\n<p>many-to-many relationships are complex</p>\n<p><img src=\"https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780138050061/files/graphics/f0761-01.jpg\" alt=\"naive implementation\"></p>\n<p>through relationships are likely better</p>\n<p><img src=\"https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780138050061/files/graphics/f0761-02.jpg\" alt=\"model folled through active relationships\"></p>\n<pre><code class=\"language-ruby\">    add_index :relationships, :follower_id\n    add_index :relationships, :followed_id\n    add_index :relationships, [:follower_id, :followed_id], unique: true\n</code></pre>\n<p>would allow a unique combo or indiviual (async) relationships</p>\n<p><code>user.active_relationships.build(followed_id: ...)</code> build relationships</p>\n<p>By default, Rails expects a foreign key of the form <code>&#x3C;class>_id</code></p>\n<p><code>has_many :followeds, through: :active_relationships</code> rails default associations, overridden by <code>has_many :following, through: :active_relationships, source: :followed</code> to make more sense</p>\n<p><a href=\"https://guides.rubyonrails.org/routing.html\">https://guides.rubyonrails.org/routing.html</a></p>\n<p><a href=\"https://hotwired.dev/\">https://hotwired.dev/</a></p>\n<p><a href=\"https://www.learnenough.com/action-cable\">https://www.learnenough.com/action-cable</a></p>\n<p><code>&#x26;:to_s</code> shorthand for <code>{ |i| i.to_s }</code>, use with map for example</p>\n<p><a href=\"http://railscasts.com/episodes/274-remember-me-reset-password\">http://railscasts.com/episodes/274-remember-me-reset-password</a></p>\n<p>As a general rule, if a method doesnâ€™t need an instance of an object, it should be a class method</p>\n<p>Class methods</p>\n<pre><code class=\"language-ruby\">def self.digest(string)\nend\n\ndef User.digest(string)\nend\n\nclass &#x3C;&#x3C; self\ndef digest(string)\nend\nend\n</code></pre>\n<p><code>if (user_id = session[:user_id])</code> if session id exists, ,assing to user_id. () is a convention to denote assignment</p>\n<p>pushing to heroku with maintenence mode</p>\n<pre><code class=\"language-bash\">heroku maintenance:on\ngit push heroku\nheroku run rails db:migrate\nheroku maintenance:off\n</code></pre>\n<p><code>before_create :create_activation_digest</code> method reference, calls the method create_activation_digest</p>\n<pre><code class=\"language-ruby\"># mutliple db calls\n# update_attribute(:activated,    true)\n# update_attribute(:activated_at, Time.zone.now)\n\n# single db call\nupdate_columns(activated: true, activated_at: Time.zone.now)\n</code></pre>\n<p><code>heroku addons:create sendgrid:starter</code> sendgrid addon\n<code>grep heroku .git/config</code> show config</p>\n<p><a href=\"https://docs.sendgrid.com/ui/sending-email/sender-verification\">https://docs.sendgrid.com/ui/sending-email/sender-verification</a></p>","frontmatter":{"date":"March 29, 2023","title":"Rails Tutorial","tags":["tutorial"]}}},"pageContext":{"slug":"/workshops/railsbook-tutorial/"}},
    "staticQueryHashes": ["1929983096","3649515864"]}